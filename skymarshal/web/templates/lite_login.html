<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5, user-scalable=yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Skymarshal - Login</title>

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="https://dr.eamer.dev/assets/images/favicon.ico">

    <!-- Open Graph / Social Share -->
    <meta property="og:title" content="Skymarshal - Bluesky Content Manager">
    <meta property="og:description" content="Search, filter, and manage your Bluesky posts, replies, likes, and reposts. Delete unwanted content in bulk or individually. Export your data as CSV or CAR backups.">
    <meta property="og:image" content="{{ url_for('static', filename='images/socialshare.png', _external=True) }}">
    <meta property="og:url" content="https://dr.eamer.dev/skymarshal/">
    <meta property="og:type" content="website">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Skymarshal - Bluesky Content Manager">
    <meta name="twitter:description" content="Search, filter, and manage your Bluesky posts, replies, likes, and reposts. Delete unwanted content in bulk or individually.">
    <meta name="twitter:image" content="{{ url_for('static', filename='images/socialshare.png', _external=True) }}">

    <link rel="stylesheet" href="{{ url_for('static', filename='css/lite.css') }}">
</head>
<body class="lite-body">
    <main class="lite-main">
        <section class="lite-card">
            <div style="position: absolute; top: 16px; right: 16px;">
                <button type="button" class="theme-toggle" id="theme-toggle" aria-label="Toggle light/dark mode">
                    <span id="theme-icon">üåô</span>
                    <span id="theme-text">Light</span>
                </button>
            </div>
            <h1 class="lite-title">Skymarshal</h1>
            <p class="lite-subtitle">Bluesky content manager</p>

            {% if error %}
            <div class="lite-error">
                <strong>Error:</strong> {{ error }}
            </div>
            {% endif %}

            {% if warning %}
            <div class="lite-warning">
                <strong>‚ö†Ô∏è Warning:</strong> {{ warning }}
            </div>
            {% endif %}

            <form method="post" class="lite-form">
                <div>
                    <label class="lite-label" for="handle">Bluesky Handle</label>
                    <input class="lite-input" id="handle" name="handle" type="text"
                           placeholder="@username or username.bsky.social" required autofocus
                           style="width: 100%;">
                </div>

                <div>
                    <label class="lite-label" for="password">Password</label>
                    <input class="lite-input" id="password" name="password" type="password"
                           placeholder="App password or regular password" required
                           style="width: 100%;">
                </div>

                <div id="login-progress" style="display: none; margin: 12px 0;">
                    <div style="background: var(--bg-elevated); border-radius: var(--radius); height: 4px; overflow: hidden; border: 1px solid var(--border);">
                        <div id="progress-bar" style="background: var(--primary); height: 100%; width: 0%; transition: width 0.2s ease-out;"></div>
                    </div>
                    <p id="loading-status" style="margin: 10px 0 0; font-size: 0.625rem; color: var(--text-muted); text-align: center; font-weight: 500; text-transform: uppercase; letter-spacing: 0.1em;">
                        <span id="status-text">Initializing...</span>
                    </p>
                </div>

                <button class="lite-button" type="submit" id="login-btn" style="width: 100%;">
                    Sign In
                </button>
            </form>

            <div class="lite-footer">
                <div id="rotating-tip" style="padding: 12px 0; margin-bottom: 16px; min-height: 50px; display: flex; align-items: center;">
                    <p id="tip-text" style="margin: 0; font-size: 0.75rem; line-height: 1.5; width: 100%; color: var(--text-subtle); text-align: center; transition: opacity 0.4s ease; text-transform: none; letter-spacing: normal;">
                        Use an app password for better security.
                    </p>
                </div>
                <a href="https://bsky.app/settings/app-passwords" target="_blank" rel="noopener noreferrer"
                   class="app-password-link">
                    Generate App Password
                </a>
            </div>
        </section>

        <!-- Info boxes below the sign-in container -->
        <div style="max-width: 520px; width: 100%; margin-top: 24px; display: flex; flex-direction: column; gap: 14px;">
            <!-- What this tool does -->
            <div class="info-box-primary">
                <h2 style="margin: 0 0 8px 0; font-size: 0.625rem; color: var(--text-subtle); font-weight: 500; text-transform: uppercase; letter-spacing: 0.1em;">What Skymarshal Does</h2>
                <p style="margin: 0; font-size: 0.8125rem; line-height: 1.6; color: var(--text-muted);">
                    Search, filter, and manage your Bluesky posts, replies, likes, and reposts.
                    Delete unwanted content in bulk or individually. Export your data as CSV or CAR backups.
                    View analytics: sentiment analysis, time patterns, engagement trends, word frequency.
                </p>
            </div>

            <!-- Critical deletion warning -->
            <div class="info-box-danger">
                <h2 style="margin: 0 0 8px 0; font-size: 0.625rem; color: var(--danger); font-weight: 700; text-transform: uppercase; letter-spacing: 0.1em;">Critical Warning</h2>
                <p class="danger-text" style="margin: 0; font-size: 0.8125rem; line-height: 1.6; font-weight: 500;">
                    I CANNOT RETRIEVE ANYTHING THAT YOU DELETE. Deletions are permanent and cannot be undone.
                    Always review carefully before deleting.
                </p>
            </div>
        </div>

        <!-- Footer link -->
        <p style="text-align: center; margin-top: 32px; margin-bottom: 16px; font-size: 0.625rem; text-transform: uppercase; letter-spacing: 0.1em;">
            <a href="https://lukesteuber.com" target="_blank" rel="noopener noreferrer"
               style="color: var(--text-subtle); text-decoration: none;">
                lukesteuber.com
            </a>
        </p>
    </main>
    <script>
        document.querySelector('.lite-form').addEventListener('submit', function(e) {
            const btn = document.getElementById('login-btn');
            const progressContainer = document.getElementById('login-progress');
            const progressBar = document.getElementById('progress-bar');
            const statusText = document.getElementById('status-text');

            // Disable button
            btn.disabled = true;
            btn.style.opacity = '0.6';
            btn.textContent = 'Signing In...';

            // Show progress bar immediately
            progressContainer.style.display = 'block';

            // Progress stages with realistic timing for large accounts
            const stages = [
                { message: 'Connecting to Bluesky...', progress: 10, delay: 200 },
                { message: 'Authenticating account...', progress: 20, delay: 1000 },
                { message: 'Verifying credentials...', progress: 30, delay: 2000 },
                { message: 'Creating session...', progress: 40, delay: 3000 },
                { message: 'Loading account data...', progress: 50, delay: 5000 },
                { message: 'Processing content...', progress: 60, delay: 8000 },
                { message: 'Fetching engagement data...', progress: 70, delay: 10000 },
                { message: 'Hydrating post metrics...', progress: 80, delay: 15000 },
                { message: 'Finalizing workspace...', progress: 90, delay: 20000 }
            ];

            // Cycling messages for extended processing
            const waitingMessages = [
                'Still processing large account...',
                'Loading thousands of posts...',
                'Fetching engagement metrics...',
                'Nearly complete...',
                'Processing remaining data...',
                'Just a bit longer...',
                'Finalizing account data...',
                'Almost ready...'
            ];

            let currentStage = 0;
            let waitingIndex = 0;

            function updateStage() {
                if (currentStage < stages.length) {
                    const stage = stages[currentStage];
                    statusText.textContent = stage.message;
                    progressBar.style.width = stage.progress + '%';
                    currentStage++;

                    // Use the delay specified for this stage
                    setTimeout(updateStage, stage.delay);
                } else {
                    // Cycle through waiting messages
                    statusText.textContent = waitingMessages[waitingIndex];
                    progressBar.style.width = '95%';
                    waitingIndex = (waitingIndex + 1) % waitingMessages.length;

                    // Continue cycling every 4 seconds
                    setTimeout(updateStage, 4000);
                }
            }

            // Start immediately with first stage
            updateStage();
        });

        // Rotating tips
        const tips = [
            'Use an app password for better security.',
            'Deletions are permanent. Review carefully before deleting.',
            'Search and delete your 500 most recent posts instantly.'
        ];

        let currentTipIndex = 0;
        const tipText = document.getElementById('tip-text');

        function rotateTip() {
            currentTipIndex = (currentTipIndex + 1) % tips.length;

            // Fade out
            tipText.style.opacity = '0';

            setTimeout(() => {
                tipText.textContent = tips[currentTipIndex];

                // Fade in
                tipText.style.opacity = '1';
            }, 400);
        }

        // Rotate tips every 6 seconds
        setInterval(rotateTip, 6000);

        // Theme toggle functionality
        const themeToggle = document.getElementById('theme-toggle');
        const themeIcon = document.getElementById('theme-icon');
        const themeText = document.getElementById('theme-text');

        // Load saved theme or default to dark
        const savedTheme = localStorage.getItem('theme') || 'dark';
        document.documentElement.setAttribute('data-theme', savedTheme);
        updateThemeButton(savedTheme);

        themeToggle.addEventListener('click', () => {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';

            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateThemeButton(newTheme);
        });

        function updateThemeButton(theme) {
            if (theme === 'dark') {
                themeIcon.textContent = 'üåô';
                themeText.textContent = 'Light';
                themeToggle.setAttribute('aria-label', 'Switch to light mode');
            } else {
                themeIcon.textContent = '‚òÄÔ∏è';
                themeText.textContent = 'Dark';
                themeToggle.setAttribute('aria-label', 'Switch to dark mode');
            }
        }
    </script>
    <!-- GoatCounter Analytics -->
    <script data-goatcounter="https://dr.eamer.dev/analytics/count"
            async src="https://dr.eamer.dev/analytics/count.js"></script>
</body>
</html>
